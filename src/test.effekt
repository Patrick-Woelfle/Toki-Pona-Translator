module src/test

import test
import src/constructSyntaxTree
import src/syntaxTree
import src/convertSyntaxTree
import src/effects
import src/deconstructSyntaxTree


def main() = {
  try {
    mainSuite("Toki Pona Translator") {
      test("Construc Tree: simple sentence") {
        val l: List[String] = ["soweli", "li", "moku", "e", "moku"]
        val t: SyntaxTree = Sentence([SubjectLeaf(["soweli"], [])], [Predicate(VerbLeaf([], ["moku"], []), [ObjectLeaf(["moku"], [])], [])])
        assertEqual(constructSyntaxTree(l), t)
      }
      test("Construct Tree: sentence with complicated subject") {
        val l: List[String] = ["soweli", "pimeja", "suli", "en", "soweli", "li", "moku", "e", "moku"]
        val t: SyntaxTree =  Sentence([SubjectLeaf(["soweli"], ["pimeja", "suli"]), SubjectLeaf(["soweli"], [])], [Predicate(VerbLeaf([], ["moku"], []), [ObjectLeaf(["moku"], [])], [])])
        assertEqual(constructSyntaxTree(l), t)
      }
      test("Construct Tree: sentence with complicae predicate") {
        val l: List[String] = ["soweli", "li", "wile", "moku", "pona", "e", "moku", "lili", "e", "kasi", "kepeken", "uta", "lili", "kepeken", "luka", "li", "moku", "e", "moku", "suli"]
        val t: SyntaxTree = Sentence([SubjectLeaf(["soweli"], [])], [Predicate(VerbLeaf(["wile"], ["moku"], ["pona"]), [ObjectLeaf(["moku"], ["lili"]), ObjectLeaf(["kasi"], [])], [PrepositionsLeaf(["kepeken"], ["uta"], ["lili"]), PrepositionsLeaf(["kepeken"], ["luka"], [])]), Predicate(VerbLeaf([], ["moku"], []), [ObjectLeaf(["moku"], ["suli"])], [])])
        assertEqual(constructSyntaxTree(l), t)
      }
      test("Convert Syntax Tree: simple sentence") {
        val t1: SyntaxTree = Sentence([SubjectLeaf(["soweli"], [])], [Predicate(VerbLeaf([], ["moku"], []), [ObjectLeaf(["moku"], [])], [])])
        val t2: SyntaxTree = Sentence([SubjectLeaf(["animal"], [])], [Predicate(VerbLeaf([], ["eat"], []), [ObjectLeaf(["food"], [])], [])])
        assertEqual(convertSyntaxTree(t1), t2)
      }
      test("Convert Syntax Tree: sentence with complicated subject") {
        val t1: SyntaxTree = Sentence([SubjectLeaf(["soweli"], ["pimeja", "suli"]), SubjectLeaf(["soweli"], ["suli", "pimeja"])], [Predicate(VerbLeaf([], ["moku"], []), [ObjectLeaf(["moku"], [])], [])])
        val t2: SyntaxTree = Sentence([SubjectLeaf(["animal"], ["dark", "big"]), SubjectLeaf(["animal"], ["big", "dark"])], [Predicate(VerbLeaf([], ["eat"], []), [ObjectLeaf(["food"], [])], [])])
        assertEqual(convertSyntaxTree(t1), t2)
      }
      test("Convert Syntax Tree: sentence with complicated predicate") {
        val t1: SyntaxTree = Sentence([SubjectLeaf(["soweli"], [])], [Predicate(VerbLeaf(["wile"], ["moku"], ["pona"]), [ObjectLeaf(["moku"], ["pona"])], [PrepositionsLeaf(["kepeken"], ["kili"], ["moku"])])])
        val t2: SyntaxTree = Sentence([SubjectLeaf(["animal"], [])], [Predicate(VerbLeaf(["want to"], ["eat"], ["well"]), [ObjectLeaf(["food"], ["good"])], [PrepositionsLeaf(["using"], ["plant"], ["food related"])])])
        assertEqual(convertSyntaxTree(t1), t2)
      }
      test("Deconstruct Tree: simple sentence") {
        val s1: String = deconstructSyntaxTree(constructSyntaxTree(["soweli", "li", "moku", "e", "moku"]))
        val s2: String = "animal eats food "
        assertEqual(s1, s2)
      }
      test("Deconstruct Tree: simple sentence") {
        val s1: String = deconstructSyntaxTree(constructSyntaxTree(["soweli", "pimeja", "suli", "li", "moku", "pona", "e", "jan", "ale", "e", "kili", "kepeken", "uta", "suli"]))
        val s2: String = "dark big animal eats well all person and plant using big mouth "
        assertEqual(s1, s2)
      }
    }
  } with ambiguity[Plural] { (first, second) =>
    resume(first)
  } with notThirdPersonSingular {
    resume(())
  } with ambiguityVerbOnlyLi {
    resume(true)
  }
}